<!DOCTYPE html><html lang="km"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>My Orders</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script defer src="config.js"></script><script defer src="utils.js"></script></head><body>
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">ការកុម្មង់របស់ខ្ញុំ</h3>
    <div><a class="btn btn-outline-secondary me-2" href="/">Home</a><button class="btn btn-danger" onclick="logout()">Log out</button></div>
  </div>
  <div id="alert"></div>
  <table class="table table-hover align-middle"><thead><tr><th>ID</th><th>ផលិតផល</th><th>ប្រាក់</th><th>ស្ថានភាព</th><th>Slip</th><th>Delivery</th><th>Time</th></tr></thead><tbody id="rows"></tbody></table>
</div>
<script>
  function logout(){window.auth.clear();location.href='/';}
  const rows=document.getElementById('rows');const alertBox=(t,m)=>document.getElementById('alert').innerHTML=`<div class="alert alert-${t}">${m}</div>`;
  async function load(){const res=await fetch(window.API_BASE+'/orders/mine',{headers:{...window.auth.headers()}});if(res.status===401)return location.href='/login';const data=await res.json();rows.innerHTML=data.map(o=>`<tr><td>${o.id}</td><td>${o.product}</td><td>$${Number(o.amount_usd).toFixed(2)}</td><td><span class="badge ${o.status==='Complete'?'bg-success':o.status==='Verified'?'bg-primary':'bg-warning text-dark'}">${o.status}</span></td><td>${o.slip_url?`<a href="${o.slip_url}" target="_blank">View</a>`:'-'}</td><td>${o.delivery_note?`<pre class="m-0" style="white-space:pre-wrap">${o.delivery_note}</pre>`:'-'}</td><td>${new Date(o.created_at).toLocaleString()}</td></tr>`).join('');}
  load();
</script>
</body></html>
